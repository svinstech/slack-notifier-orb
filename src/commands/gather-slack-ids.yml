description: >
  This command uses Slack API calls to gather a list of all Vouch user IDs and user-group IDs.
  It requires authentication via a Slack bot's "Bot User OAuth Token".
  You can get this token by being made a collaborator of the "Notifier" Slack app and going to this URL: https://api.slack.com/apps/A0558T317A7/oauth?

parameters:
  slack-bot-token:
    type: env_var_name
    description: The "Bot User OAuth Token" needed to authenticate Slack API calls.
  slack-data-directory:
    type: string
    description: The directory where the slack IDs will be stored.
    default: slackData
steps:
  - run:
      name: Create a directory for the Slack data
      environment:
        SLACK_DATA_DIRECTORY_PATH: <<parameters.slack-data-directory>>
      command: <<include(scripts/slack_id_lookup_table_scripts/create_slack_data_directory.sh)>>
  - run:
      name: Gather the Slack data
      environment:
        SLACK_BOT_TOKEN: <<parameters.slack-bot-token>>
        SLACK_DATA_DIRECTORY_PATH: <<parameters.slack-data-directory>>
        SLACK_USER_INFO_FILE_NAME: 'slackUserInfo.json'
        SLACK_GROUP_INFO_FILE_NAME: 'slackGroupInfo.json'
      command: <<include(scripts/slack_id_lookup_table_scripts/gather_slack_data.sh)>>
  - run:
      name: Gather Slack users and user groups
      environment:
        SLACK_DATA_DIRECTORY_PATH: <<parameters.slack-data-directory>>
        SLACK_USER_INFO_FILE_NAME: 'slackUserInfo.json'
        SLACK_GROUP_INFO_FILE_NAME: 'slackGroupInfo.json'
        SLACK_ID_LOOKUP_TABLE_FILE_NAME: 'slackIdLookupTable.txt'
      command: <<include(scripts/slack_id_lookup_table_scripts/generate_slack_id_lookup_table.sh)>>
  - store_artifacts:
          path: ~/project/<<parameters.slack-data-directory>>
